<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tracing &#8212; Velox  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css?v=279e0f84" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="I/O Optimizations and the TpchBenchmark" href="../TpchBenchmark.html" />
    <link rel="prev" title="Metrics" href="metrics.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../TpchBenchmark.html" title="I/O Optimizations and the TpchBenchmark"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="metrics.html" title="Metrics"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../develop.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../debugging.html" accesskey="U">Debugging Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tracing">
<h1>Tracing<a class="headerlink" href="#tracing" title="Link to this heading">¶</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">¶</a></h2>
<p>The query trace tool helps analyze and debug query performance and correctness issues. It helps prevent
interference from external noise in a production environment (such as storage, network, etc.) by allowing
replay of a part of the query plan and dataset in an isolated environment, such as a local machine.
This is much more efficient for query performance analysis and issue debugging, as it eliminates the need
to replay the whole query in a production environment.</p>
</section>
<section id="how-tracing-tool-works">
<h2>How Tracing Tool Works<a class="headerlink" href="#how-tracing-tool-works" title="Link to this heading">¶</a></h2>
<p>The tracing process consists of two distinct phases: the tracing phase and the replaying phase. The
tracing phase is executed within a production environment, while the replaying phase is conducted in
a local development environment.</p>
<p><strong>Tracing Phase</strong></p>
<ol class="arabic simple">
<li><p>Trace replay required metadata, including the query plan fragment, query configuration,
and connector properties, is recorded during the query task initiation.</p></li>
<li><p>Throughout query processing, each traced operator logs the input vectors or splits
storing them in a designated storage location.</p></li>
<li><p>The metadata and splits are serialized in JSON format, and the operator data inputs are
serialized using a <a class="reference external" href="https://prestodb.io/docs/current/develop/serialized-page.html">Presto serializer</a>.</p></li>
</ol>
<p><strong>Replaying Phase</strong></p>
<ol class="arabic simple">
<li><p>Read and deserialize the recorded query plan, extract the traced plan node, and assemble a plan
fragment with customized source and sink nodes.</p></li>
<li><p>The source node reads the input from the serialized operator inputs on storage and the sink operator
prints or logs out the execution stats.</p></li>
<li><p>Build a task with the assembled plan fragment in step 1. Apply the recorded query configuration and
connector properties to replay the task with the same input and configuration setup as in production.</p></li>
</ol>
<p><strong>NOTE</strong>: The presto serialization might lose input vector encoding, such as lazy vector and nested dictionary
encoding, which affects the operator’s execution. Hence, it might not always be the same as in production.</p>
<a class="reference internal image-reference" href="../../_images/trace-arch.png"><img alt="../../_images/trace-arch.png" class="align-center" src="../../_images/trace-arch.png" style="width: 600px;" />
</a>
</section>
<section id="tracing-framework">
<h2>Tracing Framework<a class="headerlink" href="#tracing-framework" title="Link to this heading">¶</a></h2>
<p>The tracing framework consists of three components:</p>
<ol class="arabic simple">
<li><p><strong>Query Trace Writers</strong>: records the metadata, input data, and scan splits.</p></li>
<li><p><strong>Query Trace Readers</strong>: load the metadata, read input data, and scan splits.</p></li>
<li><p><strong>Query Trace Replayers</strong>: display query summaries or replay the execution of the target operator.</p></li>
</ol>
<section id="trace-writers">
<h3>Trace Writers<a class="headerlink" href="#trace-writers" title="Link to this heading">¶</a></h3>
<p>There are three types of writers: <cite>TaskTraceMetadataWriter</cite>, <cite>OperatorTraceInputWriter</cite>,
and <cite>OperatorTraceSplitWriter</cite>. They are used in the prod or shadow environment to record
the real execution data.</p>
<p><strong>TaskTraceMetadataWriter</strong> records the query metadata during task creation,
serializes, and writes them into a file in JSON format. There are two kinds
of metadata:</p>
<ul class="simple">
<li><p>Query configurations and connector properties are specified by the user per query.
They can be serialized as JSON map objects (key-value pairs).</p></li>
<li><p>Plan fragment of the task (also known as a plan node tree). It can be serialized
as a JSON object, which is already supported in Velox.</p></li>
</ul>
<p><strong>OperatorTraceInputWriter</strong> records the input vectors from the target operator, it uses a Presto
serializer to serialize each vector batch and flush immediately to ensure that replay is possible
even if a crash occurs during execution. It is created during the target operator’s initialization
and writes data in the <cite>Operator::addInput</cite> method during execution. It finishes when the target
operator is closed. However, it can finish early if the recorded data size exceeds the limit specified
by the user.</p>
<p><strong>OperatorTraceSplitWriter</strong> captures the input splits from the target <cite>TableScan</cite> operator. It
serializes each split and immediately flushes it to ensure that replay is possible even if a crash
occurs during execution. Each split is serialized as follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">split</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">|</span>
</pre></div>
</div>
</section>
<section id="query-trace-readers">
<h3>Query Trace Readers<a class="headerlink" href="#query-trace-readers" title="Link to this heading">¶</a></h3>
<p>Three types of readers correspond to the query trace writers: <cite>TaskTraceMetadataReader</cite>,
<cite>OperatorTraceInputReader</cite>, and <cite>OperatorTraceSplitReader</cite>. The replayers typically use
them in the local environment, which will be described in detail in the Query Trace Replayer section.</p>
<p><strong>TaskTraceMetadataReader</strong> can load the query metadata JSON file and extract the query
configurations, connector properties, and a plan fragment. The replayer uses these to build
a replay task.</p>
<p><strong>OperatorTraceInputReader</strong> reads and deserializes the input vectors in a tracing data file.
It is created and used by a <cite>QueryTraceScan</cite> operator which will be described in detail in
the <strong>Query Trace Scan</strong> section.</p>
<p><strong>OperatorTraceSplitReader</strong> reads and deserializes the input splits in tracing split info files,
and produces a list of <cite>exec::Split</cite> for the query replay.</p>
</section>
</section>
<section id="how-to-replay">
<h2>How To Replay<a class="headerlink" href="#how-to-replay" title="Link to this heading">¶</a></h2>
<p>After the traced query finishes, its metadata and the input data for the target tasks and operators
are all saved in the directory specified by <cite>query_trace_dir</cite>.</p>
<p>To get a glance at the traced task, we can execute the following command:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">velox_query_replayer</span><span class="w"> </span><span class="o">--</span><span class="n">root_dir</span><span class="w"> </span><span class="o">/</span><span class="n">trace_root</span><span class="w"> </span><span class="o">--</span><span class="n">task_id</span><span class="w"> </span><span class="n">task</span><span class="mi">-4</span><span class="w"> </span><span class="o">--</span><span class="n">summary</span>
</pre></div>
</div>
<p>It would show something as the follows:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="o">++++++</span><span class="n">Query</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="n">summary</span><span class="o">++++++</span>
<span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">tasks</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>

<span class="o">++++++</span><span class="n">Query</span><span class="w"> </span><span class="n">configs</span><span class="o">++++++</span>
<span class="w">      </span><span class="nl">query_trace_task_reg_exp</span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="o">*</span>
<span class="w">      </span><span class="nl">query_trace_node_ids</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">      </span><span class="nl">query_trace_max_bytes</span><span class="p">:</span><span class="w"> </span><span class="mi">107374182400</span>
<span class="w">      </span><span class="nl">query_trace_dir</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">velox_test_aJqeFd</span><span class="o">/</span><span class="n">basic</span><span class="o">/</span><span class="n">traceRoot</span><span class="o">/</span>
<span class="w">      </span><span class="nl">query_trace_enabled</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>

<span class="o">++++++</span><span class="n">Connector</span><span class="w"> </span><span class="n">configs</span><span class="o">++++++</span>

<span class="o">++++++</span><span class="n">Task</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">plan</span><span class="o">++++++</span>
<span class="o">--</span><span class="w"> </span><span class="n">HashJoin</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">INNER</span><span class="w"> </span><span class="n">t0</span><span class="o">=</span><span class="n">u0</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t0</span><span class="o">:</span><span class="n">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="o">:</span><span class="n">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="o">:</span><span class="n">SMALLINT</span><span class="p">,</span><span class="w"> </span><span class="n">t3</span><span class="o">:</span><span class="n">REAL</span><span class="p">,</span><span class="w"> </span><span class="n">u0</span><span class="o">:</span><span class="n">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">u1</span><span class="o">:</span><span class="n">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">u2</span><span class="o">:</span><span class="n">SMALLINT</span><span class="p">,</span><span class="w"> </span><span class="n">u3</span><span class="o">:</span><span class="n">VARCHAR</span>
<span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">TableScan</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">table</span><span class="o">:</span><span class="w"> </span><span class="n">hive_table</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t0</span><span class="o">:</span><span class="n">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="o">:</span><span class="n">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="o">:</span><span class="n">SMALLINT</span><span class="p">,</span><span class="w"> </span><span class="n">t3</span><span class="o">:</span><span class="n">REAL</span>
<span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">TableScan</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">table</span><span class="o">:</span><span class="w"> </span><span class="n">hive_table</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">u0</span><span class="o">:</span><span class="n">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">u1</span><span class="o">:</span><span class="n">INTEGER</span><span class="p">,</span><span class="w"> </span><span class="n">u2</span><span class="o">:</span><span class="n">SMALLINT</span><span class="p">,</span><span class="w"> </span><span class="n">u3</span><span class="o">:</span><span class="n">VARCHAR</span>

<span class="o">++++++</span><span class="n">Task</span><span class="w"> </span><span class="n">Summaries</span><span class="o">++++++</span>

<span class="o">++++++</span><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="mi">-1</span><span class="o">++++++</span>

<span class="o">++++++</span><span class="n">Pipeline</span><span class="w"> </span><span class="mi">2</span><span class="o">++++++</span>
<span class="n">driver</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="w"> </span><span class="n">opType</span><span class="w"> </span><span class="n">HashProbe</span><span class="p">,</span><span class="w"> </span><span class="n">inputRows</span><span class="w"> </span><span class="mi">70720</span><span class="p">,</span><span class="w"> </span><span class="n">peakMemory</span><span class="w"> </span><span class="mf">108.00</span><span class="n">KB</span>
<span class="n">driver</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">opType</span><span class="w"> </span><span class="n">HashProbe</span><span class="p">,</span><span class="w"> </span><span class="n">inputRows</span><span class="w"> </span><span class="mi">70720</span><span class="p">,</span><span class="w"> </span><span class="n">peakMemory</span><span class="w"> </span><span class="mf">108.00</span><span class="n">KB</span>

<span class="o">++++++</span><span class="n">Pipeline</span><span class="w"> </span><span class="mi">3</span><span class="o">++++++</span>
<span class="n">driver</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="w"> </span><span class="n">opType</span><span class="w"> </span><span class="n">HashBuild</span><span class="p">,</span><span class="w"> </span><span class="n">inputRows</span><span class="w"> </span><span class="mi">48000</span><span class="p">,</span><span class="w"> </span><span class="n">peakMemory</span><span class="w"> </span><span class="mf">4.51</span><span class="n">MB</span>
<span class="n">driver</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">opType</span><span class="w"> </span><span class="n">HashBuild</span><span class="p">,</span><span class="w"> </span><span class="n">inputRows</span><span class="w"> </span><span class="mi">48000</span><span class="p">,</span><span class="w"> </span><span class="n">peakMemory</span><span class="w"> </span><span class="mf">2.25</span><span class="n">MB</span>
</pre></div>
</div>
<p>Then we can re-execute the query using the following command in the terminal or use the same flags in your IDE to debug.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">velox_query_replayer</span><span class="w"> </span><span class="o">--</span><span class="n">root_dir</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">bytedance</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">native</span><span class="o">/</span><span class="n">trace</span><span class="w"> </span><span class="o">--</span><span class="n">query_id</span><span class="w"> </span><span class="n">query</span><span class="mi">-1</span><span class="w"> </span><span class="o">--</span><span class="n">task_id</span><span class="w"> </span><span class="n">task</span><span class="mi">-1</span><span class="w"> </span><span class="o">--</span><span class="n">node_id</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Stats</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replaying</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="n">HashBuild</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Output</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">batches</span><span class="p">),</span><span class="w"> </span><span class="n">Cpu</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">48.63</span><span class="n">us</span><span class="p">,</span><span class="w"> </span><span class="n">Wall</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">65.22</span><span class="n">us</span><span class="p">,</span><span class="w"> </span><span class="n">Blocked</span><span class="w"> </span><span class="n">wall</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">24.08</span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">Peak</span><span class="w"> </span><span class="n">memory</span><span class="o">:</span><span class="w"> </span><span class="mf">4.51</span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="n">allocations</span><span class="o">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">Threads</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">breakdown</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="o">/</span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="o">/</span><span class="n">F</span><span class="w"> </span><span class="p">(</span><span class="mf">23.79</span><span class="n">us</span><span class="o">/</span><span class="mi">0</span><span class="n">ns</span><span class="o">/</span><span class="mf">14.46</span><span class="n">us</span><span class="o">/</span><span class="mf">10.38</span><span class="n">us</span><span class="p">)</span>

<span class="n">Stats</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">replaying</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="n">HashProbe</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Output</span><span class="o">:</span><span class="w"> </span><span class="mi">13578240</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="p">(</span><span class="mf">1.17</span><span class="n">GB</span><span class="p">,</span><span class="w"> </span><span class="mi">13280</span><span class="w"> </span><span class="n">batches</span><span class="p">),</span><span class="w"> </span><span class="n">Cpu</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">3.99</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">Wall</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">4.01</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">Blocked</span><span class="w"> </span><span class="n">wall</span><span class="w"> </span><span class="n">time</span><span class="o">:</span><span class="w"> </span><span class="mf">98.58</span><span class="n">ms</span><span class="p">,</span><span class="w"> </span><span class="n">Peak</span><span class="w"> </span><span class="n">memory</span><span class="o">:</span><span class="w"> </span><span class="mf">108.00</span><span class="n">KB</span><span class="p">,</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="n">allocations</span><span class="o">:</span><span class="w"> </span><span class="mi">12534</span><span class="p">,</span><span class="w"> </span><span class="n">Threads</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">breakdown</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="o">/</span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="o">/</span><span class="n">F</span><span class="w"> </span><span class="p">(</span><span class="mf">8.52</span><span class="n">ms</span><span class="o">/</span><span class="mf">1.59</span><span class="n">s</span><span class="o">/</span><span class="mf">2.39</span><span class="n">s</span><span class="o">/</span><span class="mf">20.29</span><span class="n">us</span><span class="p">)</span>

<span class="n">Memory</span><span class="w"> </span><span class="n">usage</span><span class="o">:</span><span class="w"> </span><span class="n">TaskCursorQuery_0</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">10.00</span><span class="n">MB</span>
<span class="w">    </span><span class="n">task</span><span class="p">.</span><span class="n">test_cursor</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">10.00</span><span class="n">MB</span>
<span class="w">        </span><span class="n">node</span><span class="mf">.2</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.2.1.1</span><span class="p">.</span><span class="n">OperatorTraceScan</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.2.1.0</span><span class="p">.</span><span class="n">OperatorTraceScan</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">        </span><span class="n">node</span><span class="p">.</span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="p">.</span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="mf">.0.1</span><span class="p">.</span><span class="n">CallbackSink</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="p">.</span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="mf">.0.0</span><span class="p">.</span><span class="n">CallbackSink</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">        </span><span class="n">node</span><span class="mf">.1</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">10.00</span><span class="n">MB</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.1.1.0</span><span class="p">.</span><span class="n">HashBuild</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">4.51</span><span class="n">MB</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.1.0.1</span><span class="p">.</span><span class="n">HashProbe</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">108.00</span><span class="n">KB</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.1.1.1</span><span class="p">.</span><span class="n">HashBuild</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">2.25</span><span class="n">MB</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.1.0.0</span><span class="p">.</span><span class="n">HashProbe</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mf">108.00</span><span class="n">KB</span>
<span class="w">        </span><span class="n">node</span><span class="mf">.0</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.0.0.1</span><span class="p">.</span><span class="n">OperatorTraceScan</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
<span class="w">            </span><span class="n">op</span><span class="mf">.0.0.0</span><span class="p">.</span><span class="n">OperatorTraceScan</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">reserved</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span><span class="w"> </span><span class="n">peak</span><span class="w"> </span><span class="mi">0</span><span class="n">B</span>
</pre></div>
</div>
<p>Here is a full list of supported command line arguments.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--root_dir</span></code>: The root directory where the replayer is reading the traced data, must be set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--summary</span></code>: Show the summary of the tracing including number of tasks and task ids.
It also print the query metadata including query configs, connectors properties, and query plan in JSON format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--query_id</span></code>: Specify the target query ID, it must be set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--task_id</span></code>: Specify the target task ID, it must be set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--node_id</span></code>: Specify the target node ID, it must be set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--driver_ids</span></code>: Specify the target driver IDs to replay.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--shuffle_serialization_format</span></code>: Specify the shuffle serialization format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--table_writer_output_dir</span></code>: Specify the output directory of TableWriter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--hiveConnectorExecutorHwMultiplier</span></code>: Hardware multiplier for hive connector.</p></li>
</ul>
</section>
<section id="future-work">
<h2>Future Work<a class="headerlink" href="#future-work" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/facebookincubator/velox/issues/9668">https://github.com/facebookincubator/velox/issues/9668</a></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Tracing</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#how-tracing-tool-works">How Tracing Tool Works</a></li>
<li><a class="reference internal" href="#tracing-framework">Tracing Framework</a><ul>
<li><a class="reference internal" href="#trace-writers">Trace Writers</a></li>
<li><a class="reference internal" href="#query-trace-readers">Query Trace Readers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-replay">How To Replay</a></li>
<li><a class="reference internal" href="#future-work">Future Work</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="metrics.html"
                          title="previous chapter">Metrics</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../TpchBenchmark.html"
                          title="next chapter">I/O Optimizations and the TpchBenchmark</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/develop/debugging/tracing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../TpchBenchmark.html" title="I/O Optimizations and the TpchBenchmark"
             >next</a> |</li>
        <li class="right" >
          <a href="metrics.html" title="Metrics"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Velox  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../develop.html" >Developer Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../debugging.html" >Debugging Tools</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright TBD.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>